<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <title>√úr√ºn Y√∂netimi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

    <div class="container py-5">
        <h1 class="mb-4 text-center">√úr√ºn Y√∂netimi</h1>

        <!-- Form -->
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <h2 class="h5 mb-3" id="formTitle">Yeni √úr√ºn Ekle</h2>
                <form id="productForm" class="row g-3">
                    <input type="hidden" id="productId">
                    <div class="col-md-4">
                        <label for="name" class="form-label">√úr√ºn Adƒ±</label>
                        <input type="text" class="form-control" id="name" required>
                    </div>
                    <div class="col-md-4">
                        <label for="price" class="form-label">Fiyat</label>
                        <input type="number" class="form-control" id="price" required>
                    </div>
                    <div class="col-md-4">
                        <label for="stock" class="form-label">Stok</label>
                        <input type="number" class="form-control" id="stock" required>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary" id="submitBtn">Ekle</button>
                        <button type="button" class="btn btn-secondary d-none" id="cancelBtn">Vazge√ß</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- √úr√ºn Listesi -->
        <div class="card shadow-sm">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2 class="h5 mb-0">√úr√ºn Listesi</h2>
                    <input type="text" id="searchInput" class="form-control w-25" placeholder="√úr√ºn ara...">
                </div>
                <table class="table table-striped" id="productTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Ad</th>
                            <th>Fiyat</th>
                            <th>Stok</th>
                            <th>ƒ∞≈ülemler</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let allProducts = [];

        async function loadProducts() {
            const res = await fetch('/products');
            allProducts = await res.json();
            renderProducts(allProducts);
        }

        function renderProducts(products) {
            const tbody = document.querySelector('#productTable tbody');
            tbody.innerHTML = '';
            products.forEach(p => {
                const row = document.createElement('tr');
                row.innerHTML = `
          <td>${p.id}</td>
          <td>${p.name}</td>
          <td>${p.price} ‚Ç∫</td>
          <td>${p.stock}</td>
          <td>
            <button class="btn btn-sm btn-warning me-2" onclick="editProduct(${p.id}, '${p.name}', ${p.price}, ${p.stock})">G√ºncelle</button>
            <button class="btn btn-sm btn-danger" onclick="deleteProduct(${p.id})">Sil</button>
          </td>
        `;
                tbody.appendChild(row);
            });
        }

        async function deleteProduct(id) {
            if (!confirm("Bu √ºr√ºn√º silmek istediƒüine emin misin?")) return;
            await fetch(`/products/${id}`, { method: 'DELETE' });
            loadProducts();
        }

        function editProduct(id, name, price, stock) {
            document.getElementById('formTitle').textContent = "√úr√ºn√º G√ºncelle";
            document.getElementById('submitBtn').textContent = "G√ºncelle";
            document.getElementById('cancelBtn').classList.remove("d-none");

            document.getElementById('productId').value = id;
            document.getElementById('name').value = name;
            document.getElementById('price').value = price;
            document.getElementById('stock').value = stock;
        }

        document.getElementById('cancelBtn').addEventListener('click', () => {
            resetForm();
        });

        function resetForm() {
            document.getElementById('formTitle').textContent = "Yeni √úr√ºn Ekle";
            document.getElementById('submitBtn').textContent = "Ekle";
            document.getElementById('cancelBtn').classList.add("d-none");
            document.getElementById('productId').value = "";
            document.getElementById('productForm').reset();
        }

        document.getElementById('productForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('productId').value;
            const name = document.getElementById('name').value;
            const price = parseFloat(document.getElementById('price').value);
            const stock = parseInt(document.getElementById('stock').value);

            if (id) {
                await fetch(`/products/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, price, stock })
                });
            } else {
                await fetch('/products', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, price, stock })
                });
            }

            resetForm();
            loadProducts();
        });

        // üîç Arama √∂zelliƒüi
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            const filtered = allProducts.filter(p => p.name.toLowerCase().includes(query));
            renderProducts(filtered);
        });

        loadProducts();
    </script>
</body>

</html>